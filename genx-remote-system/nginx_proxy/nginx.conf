# This configuration sets up a reverse proxy for the secure gateway.
# It listens for traffic on port 80 for the domain remote.genxfx.org
# and forwards it to the secure gateway service running on localhost:5001.

# It is highly recommended to add SSL (HTTPS) to this configuration in a
# production environment using a service like Let's Encrypt.

# Define the upstream server for the secure gateway
upstream secure_gateway {
    server 127.0.0.1:5001;
}

# Define the upstream server for the LiteWriter service
upstream litewriter_server {
    # This should be the address of your LiteWriter server
    server 10.62.78.114:8000;
}

server {
    listen 80;
    server_name remote.genxfx.org;

    location / {
        # Proxy requests to the secure gateway
        proxy_pass http://secure_gateway;

        # Set headers to pass information to the gateway
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # An example of a direct proxy to LiteWriter, if you wanted a separate, unsecured path.
    # It is recommended to route all traffic through the secure gateway.
    # location /unsecured/ {
    #     proxy_pass http://litewriter_server/;
    #     proxy_set_header Host $host;
    # }
}